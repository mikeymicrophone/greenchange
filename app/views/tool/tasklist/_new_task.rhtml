<%
  users = []
  users += @page.users if @page.users
  users += @page.group.users if @page.group
  users.uniq!
%>

<% @task = Task::Task.new %>
<div id="new-task-link">
  <%= link_to_function 'add task', 'Element.show("new-task-form-container"); Element.hide("new-task-link");' %> 
</div>

<div id='new-task-form-container' style='display:none'>
<% form_remote_tag(
  :url      => page_xurl(@page, :action=>'create_task'),
  :html     => {:action => page_url(@page, :action=>'create_task'), :id => 'new-task-form'}, # non-ajax fallback
  :loading  => "$('new-task-loading').show()",
  :complete => "$('new-task-loading').hide()",
  :success => "$('new-task-form').reset()"
) do -%>
   description:<br/>
   <%= text_field 'task', 'name', :size => 50 %>
   <br/>
   detail:<br/>
   <%= text_area 'task', 'description', :size => '50x4' %>
   <br/>
   assign to:<br/>
   <%= select 'task', 'user_id', [''] + users.to_select('login') %>
   <br/>
   <p>
   <%= submit_tag 'Add Task' %>
   <%= button_to_function "Done", "Element.hide('new-task-form-container'); Element.show('new-task-link');" %>
   <%= image_tag "spinner.gif", :id=>'new-task-loading', :style=>'display:none' %>
   </p>
<% end -%>
</div> <!-- end new task form -->
